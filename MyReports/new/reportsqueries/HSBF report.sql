SELECT * from (SELECT wv.rname AS region,wv.cname as council,ft.name AS type, wv.name AS facility,fs.code,fs.description,sum(budget) as budget, sum(carryover) as carryover, sum(current) as current,sum(expenditure) as expenditure,sum(carryover + current - expenditure) as fund_balance from facility_ward_view  wv JOIN facilities f ON f.id = wv.id JOIN facility_types ft ON ft.id = f.facility_type_id LEFT JOIN ( SELECT fr.facility_id,gl.gfs_code,funding_source_id,0.00 as budget,sum(amount) as carryover,0.00      as current,0.00 as expenditure from fund_trackings fr join gl_accounts gl on gl.code  = fr.gl_account where fr.date < (select start_date from financial_years where '2023-07-01' between start_date and end_date  ) group by fr.funding_source_id, fr.facility_id,gfs_code UNION ALL select fr.facility_id,gl.gfs_code,funding_source_id,0.00 as budget,0.00        as carryover,sum(amount) as current,0.00 as expenditure from fund_trackings fr join gl_accounts gl on gl.code  = fr.gl_account where fr.date between '2023-07-01' and '2024-02-25' and fr.transaction_type != 'App\Models\Payable' group by fr.funding_source_id, fr.facility_id,gl.gfs_code union all select fr.facility_id,gl.gfs_code, funding_source_id,0.00 as budget,0.00             as carryover,0.00 as current,sum(-1 * amount) as expenditure from fund_trackings fr join gl_accounts gl on gl.code  = fr.gl_account where fr.date between '2023-07-01' and '2024-02-25' and fr.transaction_type = 'App\Models\Payable' group by fr.funding_source_id, fr.facility_id,gfs_code union all select ac.facility_id,gc.code as gfs_code,funding_source_id, sum(amount) as budget,0.00        as carryover,0.00  as current,0.00 as expenditure from activity_costings ac join gfs_codes gc on ac.gfs_code_id = gc.id where ac.financial_year_id = 3 group by ac.funding_source_id, ac.facility_id,gc.code)sub on f.id = sub.facility_id join gfs_codes gfs on gfs.code = sub.gfs_code join funding_sources fs on fs.id = sub.funding_source_id group by wv.rname, wv.cname, ft.name, wv.name, fs.code, fs.description)sb where code = 'Z01' 


--- paramters start_date (replaces '2023-07-01')  and end_date (replaces 2024-02-25 )  and financial_year_id ( replaces 3) 
